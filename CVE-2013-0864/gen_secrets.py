#!/usr/bin/env python3
import os
import sys
import time

MAX_LEN = 256

gif_path = os.path.join(os.path.dirname(sys.argv[0]), 'tiny-exploit.gif')
b = open(gif_path, 'rb').read()
assert len(b) <= MAX_LEN, 'tiny-exploit.gif is too large (%d bytes)' % len(b)

time_str = time.strftime('%c')
print('// Auto-generated by gen_secrets.py at %s' % time_str)
print('uint8_t secret_data[%d] SECRET_GLOBAL = {' % MAX_LEN)
for i in range(0, MAX_LEN, 16):
    s = ''
    for j in range(i, i + 16):
        if j >= len(b):
            s += '0, '
        else:
            s += '0x%02x, ' % b[j]
    if s[-1] == ' ':
        s = s[:-1]
    print('    ' + s)
print('};')
print('size_t secret_data_len SECRET_GLOBAL = %d;' % len(b))
