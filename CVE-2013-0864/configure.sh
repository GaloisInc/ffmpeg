#!/bin/bash
FFMPEG_DIR="$(dirname "$0")/.."
PICOLIBC_HOME="$FFMPEG_DIR/../picolibc/build/image/picolibc/x86_64-unknown-fromager"

CLANG_DIR="$(clang${LLVM_SUFFIX} -print-resource-dir)"

CFLAGS="-flto -mprefer-vector-width=1
    -nostdinc
    -isystem $CLANG_DIR/include
    -isystem $PICOLIBC_HOME/include
    -ggdb
    "


"$FFMPEG_DIR/configure" \
    --disable-asm \
    --disable-doc \
    --cc="$(echo clang${LLVM_SUFFIX} $CFLAGS)" \
    --cxx="$(echo clang++${LLVM_SUFFIX} -fno-rtti $CFLAGS)" \
    --disable-pthreads \
    --enable-small \
    --disable-everything \
    --enable-demuxer=gif \
    --enable-decoder=gif \
    --enable-encoder=rawvideo \
    --enable-muxer=null \
    --disable-filter=null

mv config.h config.h.orig
cat config.h.orig |
    sed -e '/HAVE_\(MMAP\|NANOSLEEP\|USLEEP\|ISATTY\)/s/1/0/g' \
    >config.h
