CVE-2013-0864
=============

- Fixed in `c10350358da58600884292c08a8690289b81de29`
- https://www.cvedetails.com/cve/CVE-2013-0864/
- All commands are run from the top level directory of this repository.

Compile
-------

The build process is a bit complicated because we need a single monolithic LLVM
module containing the driver and all the necessary library components.

Build the libraries:
```
# Compiling with `clang -flto` produces LLVM bitcode instead of normal object files
./configure --disable-asm --disable-doc --cc='clang -flto' --cxx='clang++ -flto' \
    --disable-everything --enable-protocol=file --enable-demuxer=gif --enable-decoder=gif \
    --enable-encoder=rawvideo --enable-muxer=null --disable-filter=null
make -j8 libavcodec/libavcodec.a libavformat/libavformat.a libavutil/libavutil.a
```

Build the driver:
```
clang -flto -c CVE-2013-0864/driver.c -I .
```

Link:
```
mkdir work
cd work
for f in libavformat libavcodec libavutil; do mkdir $f; (cd $f; ar x ../../$f/$f.a); done
# Remove duplicate objects - otherwise we get symbol conflicts
rm libavcodec/log2_tab.o libavformat/log2_tab.o
cd ..
# Link
llvm-link-9 -o driver-full.bc driver.o work/*/*.o
# Optimize
opt-9 -O3 -o driver-opt.bc driver-full.bc
# Produce an executable
clang -o driver driver-opt.bc -static -lm -lpthread
```

Read a GIF
----------

Read in a GIF:

```
./driver CVE-2013-0864/jerry.gif
```

This runs the GIF decoder but simply discards the video stream.

Trigger vulnerability
---------------------

Trigger buffer overflow by attempting to read a bad GIF:

```
./driver CVE-2013-0864/payload.gif
```

This consistently triggers a segmentation fault on my system (OS X) when compiled with Apple LLVM version 10.0.1 (clang-1001.0.46.4).

Payload modified from [here](https://66.media.tumblr.com/5a646387587dd017f65b3742951670b3/tumblr_mjq8ocHhEE1rpur03o1_400.gifv).

System calls
------------

Trace the system calls with the payload.

```
strace -o CVE-2013-0864/strace_out.txt -c -- ./driver CVE-2013-0864/payload.gif
```

